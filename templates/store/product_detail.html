{% extends "base.html" %}
{% load static %}
{% load store_tags %}

{% block title %}{{ product.name }} - Carti_Leather{% endblock %}

{% block content %}
    <section class="product-detail">
        <div class="container">
            <!-- –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
            <nav class="breadcrumbs">
                <a href="{% url 'store:index' %}">–ì–æ–ª–æ–≤–Ω–∞</a>
                <span>/</span>
                <a href="{% url 'store:catalog' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
                {% if product.category %}
                    <span>/</span>
                    <a href="{% url 'store:catalog' %}?category={{ product.category.slug }}">{{ product.category.name }}</a>
                {% endif %}
                <span>/</span>
                <span>{{ product.name }}</span>
            </nav>

            <div class="product-detail-content">
                <!-- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É -->
                <div class="product-images">
                    <div class="main-image">
                        <img src="{% get_main_image product %}"
                            alt="{{ product.name }}" 
                            id="mainProductImage" 
                            onclick="openImageModal()">
                    </div>
                    <h4 class="image-hint">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –≥–æ–ª–æ–≤–Ω–µ —Ñ–æ—Ç–æ, —â–æ–± –∑–±—ñ–ª—å—à–∏—Ç–∏ –π–æ–≥–æ üëÜ</h4>

                    {% if product.images.all|length > 1 %}
                        <div class="thumbnail-images">
                            {% for image in product.images.all %}
                                <img src="{{ image.image.url }}"
                                    alt="{{ image.alt_text|default:product.name }}"
                                    class="thumbnail {% if forloop.first %}active{% endif %}"
                                    onclick="changeMainImage('{{ image.image.url }}', this)">
                            {% endfor %}

                        </div>
                    {% endif %}
                </div>

                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–æ–≤–∞—Ä -->
                <div class="product-info">
                    <h1>{{ product.name }}</h1>

                    <div class="product-price">
                        {% if product.discount_price %}
                            <span class="current-price">{{ product.discount_price|currency }}</span>
                            <span class="old-price">{{ product.price|currency }}</span>
                            <span class="discount-badge">-{{ product.discount_percentage }}%</span>
                        {% else %}
                            <span class="current-price">{{ product.price|currency }}</span>
                        {% endif %}
                    </div>

                    <div class="product-description">
                        {{ product.description|safe }}
                    </div>

                    <!-- –û–ø—Ü—ñ—ó —Ç–æ–≤–∞—Ä—É -->
                    <form id="addToCartForm" method="POST" action="{% url 'cart:add_to_cart' %}">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ product.id }}">

                        {% if product.colors %}
                            <div class="product-option">
                                <label>–ö–æ–ª—ñ—Ä:</label>
                                <div class="option-buttons">
                                    {% for color in product.colors %}
                                    <label class="option-btn">
                                        <input type="radio" name="color" value="{{ color }}" {% if forloop.first %}checked{% endif %}>
                                        <span>{{ color }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}

                        {% if product.sizes %}
                            <div class="product-option">
                                <label>–†–æ–∑–º—ñ—Ä:</label>
                                <div class="option-buttons">
                                    {% for size in product.sizes %}
                                        <label class="option-btn">
                                            <input type="radio" name="size" value="{{ size }}" {% if forloop.first %}checked{% endif %} >
                                            <span>{{ size }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}

                        <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å -->
                        <div class="quantity-section">
                            <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</label>
                            <div class="quantity-controls">
                                <button type="button" class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                                <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}" id="quantityInput">
                                <button type="button" class="quantity-btn" onclick="changeQuantity(1)">+</button>
                            </div>
                            <span class="stock-info">–í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ: {{ product.stock }} —à—Ç.</span>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É" -->
                        <div class="product-actions">
                            {% if product.stock > 0 %}
                                <button type="submit" class="add-to-cart-btn">
                                    <i class="fas fa-shopping-cart"></i>
                                    –î–æ–¥–∞—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                            {% else %}
                                <button type="button" class="add-to-cart-btn disabled" disabled>
                                    –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                                </button>
                            {% endif %}
                        </div>
                    </form>

                    <!-- –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—É -->
                    {% if product.features %}
                        <div class="product-features">
                            <h3>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</h3>
                            <ul>
                                {% for feature in product.features %}
                                    <li>{{ feature }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∏ —Ç–æ–≤–∞—Ä—É -->

            <div class="product-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('description', event)">–ü–æ–≤–Ω–∏–π –æ–ø–∏—Å</button>
                    <button class="tab-btn" onclick="showTab('care')">–î–æ–≥–ª—è–¥ –∑–∞ —à–∫—ñ—Ä—è–Ω–∏–º –≤–∏—Ä–æ–±–æ–º</button>
                    <button class="tab-btn" onclick="showTab('delivery')">–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–∞ —É–º–æ–≤–∏</button>
                </div>

                <div class="tab-content">
                    <div id="description" class="tab-pane active">
                        {{ product.full_description|default:product.description|safe }}
                    </div>

                    <div id="care" class="tab-pane">
                        {% if product.care_instructions %}
                            {{ product.care_instructions|safe }}
                        {% else %}
                            {{ default_care|safe }}
                        {% endif %}
                    </div>

                    <div id="delivery" class="tab-pane">
                        <h4>–£–º–æ–≤–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:</h4>
                        <ul>
                            <li>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ –≤—ñ–¥ 10 000 –≥—Ä–Ω</li>
                            <li>–î–æ—Å—Ç–∞–≤–∫–∞ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –ù–æ–≤–æ—é –ü–æ—à—Ç–æ—é</li>
                            <li>–¶—ñ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç–∞—Ä–∏—Ñ—ñ–≤ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞</li>
                            <li>–û–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è: –æ–Ω–ª–∞–π–Ω –Ω–∞ –∫–∞—Ä—Ç—É –∞–±–æ –Ω–∞–∫–ª–∞–¥–µ–Ω–∏–º –ø–ª–∞—Ç–µ–∂–æ–º</li>
                            <li><span style="color: red;">–ù–∞–∫–ª–∞–¥–µ–Ω–∏–π –ø–ª–∞—Ç—ñ–∂ (–∑–∞ —É–º–æ–≤–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∏ –≤ 20% –≤—ñ–¥ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è)</span></li>
                        </ul>
                            
                        <h4>–¢–µ—Ä–º—ñ–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥ 3 –¥–æ 10 –¥—ñ–± –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥:</h4>
                        <ul>
                            <li>–†—ñ–≤–Ω—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—è –≤–∏—Ä–æ–±—É</li>
                            <li>–†—ñ–≤–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω–æ—Å—Ç—ñ –º–∞–π—Å—Ç—Ä—ñ–≤</li>
                            <li>–ù–∞—è–≤–Ω–æ—Å—Ç—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó —à–∫—ñ—Ä–∏ —Ç–∞ —Ñ—É—Ä–Ω—ñ—Ç—É—Ä–∏</li>
                            <li>–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏—Ö –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç–µ–π –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–∑–º—ñ–Ω–∞ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –≤–∏—Ä–æ–±—É, –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–±–æ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –¥–µ—è–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π –Ω–∞ –≤–∏—Ä–æ–±—ñ, –≥—Ä–∞–≤—ñ—Ä—É–≤–∞–Ω–Ω—è)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- –°—Ö–æ–∂—ñ —Ç–æ–≤–∞—Ä–∏ -->
            {% if related_products %}
                <section class="related-products">
                    <h2>–°—Ö–æ–∂—ñ —Ç–æ–≤–∞—Ä–∏</h2>
                    <div class="products-grid">
                        {% for product in related_products %}
                            <div class="product-card" onclick="location.href='{% url 'store:product_detail' product.id %}'">
                                <div class="product-image">
                                    <img src="{% get_main_image product %}" alt="{{ product.name }}">
                                </div>
                                <div class="product-info">
                                    <h3>{{ product.name }}</h3>
                                    <div class="product-price">
                                        {% if product.discount_price %}
                                            <span class="current-price">{{ product.discount_price|currency }}</span>
                                            <span class="old-price">{{ product.price|currency }}</span>
                                            <span class="discount-badge">-{{ product.discount_percentage }}%</span>
                                        {% else %}
                                            <span class="current-price">{{ product.price|currency }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}
        </div>
    </section>
<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <span class="close-btn" onclick="closeImageModal()">√ó</span>
    <img class="modal-content" id="modalImage">
    <button class="prev-btn" onclick="event.stopPropagation(); changeModalImage(-1)">‚ùÆ</button>
    <button class="next-btn" onclick="event.stopPropagation(); changeModalImage(1)">‚ùØ</button>
</div>
<style>

</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/product_detail.js' %}"></script>
{% endblock %}
